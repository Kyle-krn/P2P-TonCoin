{% extends "base.html" %}
{% block title %}User {{user.tg_username}}{% endblock %}
{% block body %}

{% for message in get_flashed_messages(request) %}
  <div class="alert alert-{{message.category}}" role="alert">
    {{ message.message }}
  </div>
 {% endfor %}

<!-- USER INFO -->
<table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th scope="col"></th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="text-center"><b>UUID:</b></td>
        <td class="text-center">{{user.uuid}}</td>
      </tr>
      <form action="/update_user/{{user.uuid}}{{params}}" method="post">
      <tr>
        <td class="text-center"><b>Username:</b></td>
        <td class="text-center">{{user.tg_username}}
            <!-- <input type="text" class="form-control text-center" placeholder="Username" value="{{user.tg_username}}" aria-label="Username"> -->
        </td>
      </tr>
      <tr>
        <td class="text-center"><b>Wallet:</b></td>
        <td class="text-center">
            <input name="wallet" type="text" class="form-control text-center" placeholder="Wallet" value="{% if user.wallet == None %}{% else %}{{user.wallet}}{% endif %}" aria-label="Wallet">
        </td>
      </tr>
      <tr>
        <td class="text-center"><b>Balance:</b></td>
        <td class="text-center">
            <div class="input-group flex-nowrap">
            <input name="balance" type="number" class="form-control text-center" placeholder="Balance" value="{{user.balance}}" aria-label="Balance" step="any" required>
            <span class="input-group-text" id="addon-wrapping">TON</span>
            </div>
        </td>
      </tr>
      <tr>
        <td class="text-center"><b>Frozen Balance:</b></td>
        <td class="text-center">
            <div class="input-group flex-nowrap">
            <input name="frozen_balance" type="number" class="form-control text-center" placeholder="Frozen balance" value="{{user.frozen_balance}}" aria-label="Frozen balance"  aria-describedby="addon-wrapping" step="any" required>
            <span class="input-group-text" id="addon-wrapping">TON</span>
            </div>
        </td>
      </tr>
      <tr>
        <td class="text-center"><b>Referal Parent:</b></td>
        <td class="text-center">
            <div class="input-group mb-3">
                {% if user.referal_user_id == None %}
                <a class="btn btn-outline-secondary" href="#" type="button" id="button-addon1" role="button" disabled>Parent</a>
                <input name="referal_parent" type="text" class="form-control" placeholder="Referal Parent UUID" aria-label="Example text with button addon" aria-describedby="button-addon1">
                {% else %}
                <a class="btn btn-outline-secondary" href="/user/{{user.referal_user_id}}" type="button" id="button-addon1" role="button">Parent</a>
                <input name="referal_parent" type="text" class="form-control" placeholder="Referal Parent UUID" aria-label="Example text with button addon" aria-describedby="button-addon1"
                 value="{{user.referal_user_id}}">
                {% endif %}
                
              </div>
        </td>
      </tr>
      <tr>
        <td class="text-center"><b>Created at:</b></td>
        <td class="text-center">{{ user.created_at | format_date }}</td>
      </tr>
      <tr>
        <td class="text-center"></td>
        <td class="text-center"><button type="submit" class="btn btn-success">Update</button></td>
      </tr>
    </form>
    </tbody>
</table>
<!-- END USER INFO -->

<!-- CHANGE BALANCE -->
<br>
<h3 class="text-center">Change Balance:</h3>
<div class="table-responsive">
<table class="table table-striped">
    <thead>
      <tr class="text-center">  
        <th scope="col">#</th>
        <th scope="col">Type</th>
        <th scope="col">Amount</th>
        <th scope="col">Hash</th>
        <th scope="col">Wallet</th>
        <th scope="col">Code</th>
        <th scope="col">State</th>
        <th scope="col">Created at</th>
        <!-- <th scope="col">Update</th> -->
    </thead>
    <tbody>
    <form action="/update_history_balance{{params}}" method="post">
    <input type="hidden" value="{{user.uuid}}" name="user_uuid_hidden">
    {% for history_balance in user.history_balance %}
    <input type="hidden" value="{{history_balance.uuid}}" name="uuid_history_balance">
    <tr class="text-center">
    <th scope="row">{{loop.index}}</th>
    <!-- TYPE -->
    <td>
        <select name="type" class="form-select" aria-label="Default select example">
        {% if history_balance.type == "topup" %}
        <option selected value="topup">Top up</option>
        <option value="withdraw">Withdraw</option>
        {% else %}
        <option selected value="withdraw">Withdraw</option>
        <option value="topup">Top up</option>
        {% endif %}
      </select>
    </td>
    <!-- END TYPE -->
    
    <!-- AMOUNT -->
    <td>
        <input name="amount" type="number" class="form-control text-center" placeholder="Amount" 
        value="{{history_balance.amount}}" aria-label="Amount" step="any">
    </td>
    <!-- END AMOUNT  -->

    <!-- HASH -->
    <td>
        <textarea name="hash" type="text" class="form-control text-center" placeholder="Hash" 
        aria-label="Hash">{% if history_balance.hash !=None %}{{history_balance.hash}}{%endif%}</textarea>
    </td>
    <!-- END HASH -->

    <!-- WALLET -->
    <td>
        <textarea name="wallet" type="text" class="form-control text-center" placeholder="Wallet" 
        aria-label="Wallet">{% if history_balance.wallet != None %}{{history_balance.wallet}}{%endif%}</textarea>
    </td>
    <!-- END WALLET -->

    <!-- CODE -->
    <td>
        <textarea name="code" type="text" class="form-control text-center" placeholder="Code" 
        aria-label="Code">{% if history_balance.code == None %}{% else %}{{history_balance.code}}{% endif %}</textarea>
    </td>

    <!-- STATE -->
    <td>
        <select name="state" class="form-select" aria-label="Default select example">
            <option value="created" {% if history_balance.state == "created" %}selected{% endif %}>Created</option>
            <option value="cancelled" {% if history_balance.state == "cancelled" %}selected{% endif %}>Cancelled</option>
            <option value="done" {% if history_balance.state == "done" %}selected{% endif %}>Done</option>
            
        </select>
    </td>
    <!-- END STATE -->
    <td>{{ history_balance.created_at | format_date }}</td>
    
    </tr>  
    {% else %} 
    <tr>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
    </tr>
    {% endfor %}
    <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td><td class="text-center"><button type="submit" class="btn btn-success btn-sm">Update</button></td></td> 
        </form>
    </tr>
    </tbody>
</table>
</div>
<!-- END CHANGE BALANCE -->
<br>
<h3 class="text-center">Referal Bonus:</h3>
<table class="table table-striped">
    <thead>
      <tr class="text-center">
        <th scope="col">#</th>
        <th scope="col">Invited User</th>
        <th scope="col">State</th>
        <th scope="col">Amount</th>
        <th scope="col">Created at</th>
    </thead>
    <tbody>
       {% for referal_bonus in user.send_referal %}
       <tr class="text-center">
        <th scope="row">{{loop.index}}</th>
        <td><a href="/user/{{referal_bonus.invited_user.uuid}}">{{referal_bonus.invited_user.tg_username}}</a></td>
        <td>{{referal_bonus.state}}</td>
        <td>{{referal_bonus.amount}} TON</td>
        <td>{{referal_bonus.created_at | format_date }}</td>
       </tr>
       {% else %} 
    <tr>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
    </tr>
       {% endfor %}
    </tbody>
</table>
<!--END REFERAL BONUS -->

<!-- PAYMENT ACCOUNT -->
<br>
<h3 class="text-center">Payment Account:</h3>
<table class="table table-striped">
    <thead>
      <tr class="text-center">  
        <th scope="col">#</th>
        <th scope="col">Type</th>
        <th scope="col">Data</th>
        <th scope="col">is_active</th>
        <th scope="col">Updated at</th>
        <th scope="col">Created at</th>
        </thead>
    <tbody>
        
    {% for payments_account in user.payments_account %}
    <tr class="text-center">
    <th scope="row">{{loop.index}}</th>
    <td>{{payments_account.type.name}}</td>
    <td>{% for k,v in payments_account.data.items() %}{{k}} - {{v}}<br>{% endfor %}</td>
    <td>{{payments_account.is_active}}</td>
    <td>{{payments_account.updated_at | format_date}}</td>
    <td>{{payments_account.created_at | format_date}}</td>
    </tr>   
    {% else %} 
    <tr>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
        <td class="text-center">---</td>
    </tr>
    {% endfor %}   
    </tbody>
</table>
<!--END PAYMENT ACCOUNT -->


    {% endblock %}